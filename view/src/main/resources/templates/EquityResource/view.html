<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RxMarkets | Viewing Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 10px;
            padding: 0;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
{#if ticker and market}
<h1 style="display:none">Viewing ${ticker ?: "NULL"} on {market}</h1>
{#for score in scores}
<div style="display:none">
    <h3>{score.date}:</h3>
    <ul>
        {#for s in score.scores}
        <li>
            {s.key} = {s.value}
        </li>
        {/for}
    </ul>
    <p/>
</div>
{/for}
<canvas id="sentimentChart"></canvas>
<script>
    const industrySentiment = [];
    const growthPotential = [];
    const productsAndServices = [];
    const lis = document.querySelectorAll('li');
    for (const li of lis) {
      const text = li.textContent;
      if (text.includes('INDUSTRY_SENTIMENT')) {
        const value = parseFloat(text.match(/= (\d+\.\d+)/)[1]);
        industrySentiment.push(value);
      }
      if (text.includes('GROWTH_POTENTIAL')) {
        const value = parseFloat(text.match(/= (\d+\.\d+)/)[1]);
        growthPotential.push(value);
      }
      if (text.includes('PRODUCTS_AND_SERVICES')) {
        const value = parseFloat(text.match(/= (\d+\.\d+)/)[1]);
        productsAndServices.push(value);
      }
    }
    const ctx = document.getElementById('sentimentChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['0', '1', '2'],
        datasets: [{
          label: 'Industry Sentiment',
          data: industrySentiment,
          borderColor: 'blue',
          fill: false
        }, {
          label: 'Growth Potential',
          data: growthPotential,
          borderColor: 'green',
          fill: false
        }, {
          label: 'Products & Services',
          data: productsAndServices,
          borderColor: 'red',
          fill: false
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
</script>
{#else}
<h1 style="color:red">Unable to locate equity for ${ticker ?: "NULL"} on {market ?: "NULL"}</h1>
{/if}
</body>
</html>